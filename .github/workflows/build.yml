name: Build Cheat Engine

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Install Lazarus
      uses: gidesign/setup-lazarus@v1
      with:
        lazarus-version: stable
        include-packages: "lazwin32"

    - name: Build Projects
      shell: cmd
      run: |
        for /F "tokens=*" %%i in ('dir /A:-D /B /S "*.lpi"') do (lazbuild "%%i" --build-all --os=win32 --cpu=i386)

    - name: Zip Artifacts
      shell: cmd
      run: |
        if exist "Cheat Engine\bin" (
            7z a Cheat-Engine-Build.zip "Cheat Engine\bin"
        ) else (
            echo "Error: bin folder not found!"
            exit 1
        )

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Cheat-Engine-Build
        path: Cheat-Engine-Build.zip
